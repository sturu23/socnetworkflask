{% extends 'base.html' %}


{% block content %}

    <form action="{{ url_for('auth_home.create') }}" method="post">
        <div style="border: #00C4CF">
            <a href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">
                {% if current_user.profile_pic == None %}
                    <img class='rounded-circle' style="margin-left: 21%" height="50px" width="50px"
                         src="{{ url_for('static', filename='img/defaultavatar.jpg') }}" alt="pic">
                    <input type="text" placeholder="Create Post"
                           class="rounded-pill border border-info w-50 p-1 position-sticky top-0 start-50 translate-middle-x mt-4">
                {% else %}
                    <img class='rounded-circle' style="margin-left: 21%" height="50px" width="50px"
                         src="{{ url_for('static', filename='uploads/' + current_user.profile_pic) }}" alt="pic">
                    <input type="text" placeholder="Create Post"
                           class="rounded-pill border border-info w-50 p-1 position-sticky top-0 start-50 translate-middle-x mt-4">
                {% endif %}
            </a>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog"
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{ form.hidden_tag() }}
                    {{ form.title(class="form-control", placeholder="Title") }}
                    <br>
                    {{ form.content(class="form-control", placeholder="Content") }}
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    {{ form.submit(class="btn btn-primary", value="Add Post") }}
                </div>
            </div>
        </div>
        </div>
    </form>
    {% for i in range(data|length) %}


        <!-- ==============================================
        Hero
        =============================================== -->
        <section class="hero">
            <div class="container">
                <div class="row">

                    <div class="col-lg-6 offset-lg-3">

                        <div class="cardbox shadow-lg bg-white">

                            <div class="cardbox-heading">
                                <!-- START dropdown-->
                                <div class="dropdown float-right">
                                    <button class="btn btn-flat btn-flat-icon" type="button" data-toggle="dropdown"
                                            aria-expanded="false">
                                        <em class="fa fa-ellipsis-h"></em>
                                    </button>
                                    <div class="dropdown-menu dropdown-scale dropdown-menu-right" role="menu"
                                         style="position: absolute; transform: translate3d(-136px, 28px, 0px); top: 0px; left: 0px; will-change: transform;">
                                        <a class="dropdown-item" href="#">Hide post</a>
                                        <a class="dropdown-item" href="#">Stop following</a>
                                        <a class="dropdown-item" href="#">Report</a>
                                    </div>
                                </div><!--/ dropdown -->

                                <div class="media m-0">
                                    <div class="d-flex mr-3">
                                        {#                                         <a href="{{ url_for('profile.profile') }}" method="post">#}


                                        {% if data[i].user_img == None %}
                                            <img src="{{ url_for('static', filename='img/defaultavatar.jpg') }}"
                                                 alt="default" class="img-circle" width="150px" height="150px">
                                        {% else %}
                                            <img width="200px" height="200px"
                                                 src="{{ url_for('static', filename='uploads/' + data[i].user_img) }}"
                                                 class="img-responsive" alt="profile picture">
                                        {% endif %}


                                    </div>
                                    <div class="media-body">
                                        <p class="m-0">

                                            {% for user in users %}
                                                {% if user.id == data[i].user_id %}
                                                    <a href="{{ url_for('profile.profile') }}"
                                                       method="post">{{ user.username }}</a>
                                                {% endif %}
                                            {% endfor %}

                                        </p>
                                        <small><span><i
                                                class="icon ion-md-time"></i>Posted: {{ data[i].created_post_date.date().strftime("%B,%d,%Y") }}</span></small>
                                    </div>
                                </div><!--/ media -->
                            </div><!--/ cardbox-heading -->

                            <div class="cardbox-item">
                                <div class="cardbox-item-text">
                                    <p>{{ data[i].content }}</p>
                                </div>
                            </div><!--/ cardbox-item -->
                            <div class="cardbox-base">
                                {{ post[i].likes|length }}
                                {% if current_user.id in post[i].likes|map(attribute='user_id')|list %}
                                    <a href="{{ url_for('auth_home.like', post_id=post[i].id) }}"><i
                                            class="fa-sharp fa-solid fa-heart"></i></a>
                                {% else %}
                                    <a href="{{ url_for('auth_home.like', post_id=post[i].id) }}"><i
                                            class="fa-regular fa-heart"></i></a>
                                {% endif %}


                            </div><!--/ cardbox-base -->
                            <div class="cardbox-comments">
			                    <span class="comment-avatar float-left">
			   <a href=""><img class="rounded-circle"
                               src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/6.jpg"
                               alt="..."></a>
			  </span>
                                <div class="search">
                                    <form action="{{ url_for('auth_home.add_comment',post_id=data[i].id) }}"
                                          method="post">
                                        <input placeholder="Write a comment" type="text" name="text">
                                        <button type="submit" class="btn btn-primary">Comment</button>


                                        <!--/. Search -->

                                    </form>


                                </div><!--/ cardbox-like -->

                            </div><!--/ cardbox -->


{#                                {{ comments.users.username }}#}

                                        {% for comment in data[i].comments %}
                                            <div style="display:flex;">
                                            <div style="margin-left: 5px"><img width="30px" height="30px"
                                                      src="{{ url_for('static', filename='uploads/' + comment.user.profile_pic) }}"
                                                      class="img-responsive"
                                                      alt="profile picture"> {{ comment.user.username }}</div>

                                            <div style="border: #00c6ff 2px solid;display:inline-block;width: 95%;height: 30%;margin: 15px" >
                                                <h1 style="font-size: 12px; ">
                                                    {{ comment.text }}
                                                   <h1 style="margin-right: 10%;font-size: 8px">Commented: {{ comment.date_created.date().strftime("%B,%d,%Y") }}</h1>
                                                </h1>
                                            </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                        </div><!--/ col-lg-6 -->


                    </div><!--/ row -->
                </div><!--/ container -->
        </section>
    {% endfor %}
{% endblock %}